<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="codeQuery">


	<select id="list" resultType="hashmap">
		SELECT /* codeQuery.list 2013.08.21 최지순 */
			CODE
			, IDX
			, CODE_DETAIL
			, CODE_LEVEL
			, PARENT_CODE
			, CODE_DETAIL
			, DATE_FORMAT(REG_DT,'%Y-%m-%d %H:%i') AS REG_DT
		FROM  BG_CODE
		WHERE 1=1
		<if test="search != null and search != ''">
			AND (CODE LIKE CONCAT('%', #{search}, '%') OR CODE_DETAIL LIKE CONCAT('%', #{search}, '%'))
		</if>
		ORDER BY IDX DESC
		<if test="startNo != null and perPage != null">
			LIMIT #{startNo}, #{perPage}
		</if>
	</select>
	
	<select id="totalCount" resultType="int">
		SELECT /* codeQuery.totalCount 2013.08.21 최지순 */
			count(*)
		FROM  BG_CODE
		WHERE 1=1
		<if test="search != null and search != ''">
			AND (CODE LIKE CONCAT('%', #{search}, '%') OR CODE_DETAIL LIKE CONCAT('%', #{search}, '%'))
		</if>
	</select>
	
	<select id="detail" resultType="hashmap">
		SELECT /* codeQuery.detail 2013.08.21 최지순 */
			CODE
			, IDX
			, CODE_DETAIL
			, CODE_LEVEL
			, PARENT_CODE
			, CODE_DETAIL
			, DATE_FORMAT(REG_DT,'%Y-%m-%d %H:%i') AS REG_DT
		FROM  BG_CODE
		WHERE IDX = #{code_idx}
	</select>
	
	<update id="modify">
		UPDATE /* codeQuery.modify 2013.08.21 최지순 */
			BG_CODE
		SET
			CODE_DETAIL = #{code_detail}
			 ,CODE_LEVEL=#{code_level}
			 ,PARENT_CODE=#{parent_code}
			, MOD_DT = now()
		WHERE 1=1
		AND CODE = #{code}
	</update>
	 
	<delete id="deleteChild">
		DELETE  /* codeQuery.deleteChild 2013.08.21 최지순 */
		FROM BG_CODE
		WHERE PARENT_CODE IN (SELECT CODE FROM (SELECT CODE FROM BG_CODE WHERE IDX = #{code_idx}) A)
	</delete>
	 
	<delete id="delete">
		DELETE  /* codeQuery.delete 2013.08.21 최지순 */
		FROM BG_CODE
		WHERE IDX = #{code_idx}
	</delete> 
	
</mapper>
